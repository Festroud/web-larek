# Проектная работа "Веб-ларек"
Это учебный проект, созданный в рамках курса Яндекс Практикум. Он предлагает пользователям возможность взаимодействовать с системой для заказа товаров, предназначенных для веб-разработчиков.

## Стек технологий
- **HTML**
- **SCSS**
- **TypeScript**
- **Webpack**

## Структура проекта
- `src/` — исходные файлы проекта
- `src/components/` — папка с JS компонентами
- `src/components/base/` — папка с базовым кодом
- `src/pages/index.html` — HTML-файл главной страницы
- `src/types/index.ts` — файл с типами
- `src/index.ts` — точка входа приложения
- `src/scss/styles.scss` — корневой файл стилей
- `src/utils/constants.ts` — файл с константами
- `src/utils/utils.ts` — файл с утилитами

## Инструкция по сборке и запуску
1. Установить зависимости:
   ```bash
   npm install
   ```
2. Запустить проект в режиме разработки:
   ```bash
   npm run start
   ```
3. Для сборки проекта в продакшен:
   ```bash
   npm run build
   ```
---
## Архитектура проекта Web-Larek
### Базовый код
## Класс `Api`
Класс `Api` предназначен для работы с REST API. Он упрощает выполнение HTTP-запросов, таких как `GET`, `POST`, `PUT`, `DELETE`, и предоставляет единое место для управления базовым URL и настройками запросов.
### Конструктор
**`constructor(baseUrl: string, options: RequestInit = {})`**  
Создает экземпляр API-клиента.
- **Параметры:**
  - `baseUrl` (string): Базовый URL для всех запросов.
  - `options` (RequestInit): Настройки запросов, применяемые по умолчанию. Может включать в себя:
   - `headers`: Заголовки (например, авторизация через `Authorization: Bearer <token>`).
---
### Поля
- **`baseUrl` (string):**  
  Хранит базовый URL, указанный при создании экземпляра класса.
- **`options` (RequestInit):**  
  Содержит настройки запросов, включая заголовки (`headers`) и другие параметры, которые применяются по умолчанию ко всем запросам.
---
### Методы
1. `get(uri: string): Promise<object>`  
Выполняет GET-запрос на указанный путь.

- **Параметры:**
  - `uri` (string): Путь к ресурсу (добавляется к `baseUrl`).

- **Возвращает:**  
  Промис с данными, полученными от сервера.
2. `post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>`
Выполняет POST-запрос (или другой указанный метод) с передачей данных в теле запроса.

- **Параметры:**
`uri (string)`: Путь к ресурсу (добавляется к `baseUrl`).
`data (object)`: Данные, передаваемые в теле запроса (в формате JSON).
`method (ApiPostMethods): HTTP-метод (POST, PUT, DELETE)`. По умолчанию — `POST`.
- **Возвращает:** 
Промис с данными, полученными от сервера.
**Базовый URL:**
Методы автоматически добавляют базовый `URL (baseUrl)` к переданным путям `(uri)`.
**Обработка ответа:**
При успешном запросе возвращает данные в формате JSON.
При ошибке пытается извлечь сообщение об ошибке из ответа или возвращает текст статуса.
**Типы**
`ApiPostMethods`
Тип для указания методов HTTP-запросов:
`type ApiPostMethods = 'POST' | 'PUT' | 'DELETE';`
`ApiListResponse<Type>`
Тип ответа для получения списка элементов:
```type ApiListResponse<Type> = {
  total: number;
  items: Type[];
};
```
---

**Класс EventEmitter**
Класс EventEmitter реализует паттерн "Emitter" для работы с событиями, позволяя подписываться на события, генерировать их и управлять подписками. Он реализует интерфейс IEvents, который описывает основные методы для работы с событиями.
**Поля**
`_events: Map<EventName, Set<Subscriber>>`
Это приватное поле, представляющее карту, где ключи — имена событий или регулярные выражения (тип EventName), а значения — множества подписчиков, которые слушают эти события. Это хранилище событий и подписок.
**Конструктор**
```constructor() {
    this._events = new Map<EventName, Set<Subscriber>>();
}
```
**Назначение:**
 Конструктор инициализирует пустую карту событий `(_events)`, которая будет хранить все подписки на события. Каждый ключ в этой карте — это либо строка (имя события), либо регулярное выражение для шаблонного поиска событий.

**Методы**
`on<T extends object>(eventName: EventName, callback: (event: T) => void): void`
**Назначение:** Подписывает обработчик (callback) на указанное событие (eventName).
**Параметры:**
`eventName:` Имя события или регулярное выражение, которое будет проверяться при вызове события.
`callback:` Функция, которая будет вызвана, когда событие произойдёт. Она принимает объект данных типа T, связанный с событием.
**Действие:** Если событие ещё не существует в _events, оно добавляется, и подписчик (callback) регистрируется для этого события.

`off(eventName: EventName, callback: Subscriber): void`
**Назначение:** Удаляет обработчик (callback) для указанного события (eventName).
**Параметры:**
`eventName:` Имя события, с которого нужно снять обработчик.
`callback:` Обработчик, который нужно удалить.
**Действие:** Если событие существует в _events, удаляется подписчик. Если после этого в событии не остаётся подписчиков, оно также удаляется из карты.

`emit<T extends object>(eventName: string, data?: T): void`
**Назначение:** Инициирует событие с указанным именем (eventName) и переданными данными (data).
**Параметры:**
`eventName:` Имя события, которое должно быть вызвано.
data: Данные, которые могут быть переданы подписчикам при срабатывании события (необязательный параметр).
**Действие:** Проходит по всем событиям в _events. Если имя события совпадает с переданным или соответствует регулярному выражению, вызываются все подписчики для этого события. В случае события "*" вызываются все подписчики на все события.

`onAll(callback: (event: EmitterEvent) => void): void`
**Назначение:** Подписывается на все события. Когда любое событие срабатывает, вызывается указанный обработчик callback.
**Параметры:**
`callback:` Функция, которая будет вызвана для каждого события, получая объект с именем события (eventName) и данными (data).
**Действие:** Этот метод позволяет подписаться на все события в системе, используя событие с именем "*".
offAll(): void
**Назначение:** Удаляет все подписки на события, очищая хранилище _events.
**Действие:** После вызова этого метода все события и их подписчики удаляются, и карта _events очищается.

`trigger<T extends object>(eventName: string, context?: Partial<T>): (data: T) => void`

**Назначение:**
 Создаёт функцию-генератор события, которая при вызове будет инициировать событие с указанными данными.
**Параметры:**
`eventName:` Имя события, которое нужно будет инициировать.
`context:` Данные, которые будут объединены с переданными данными при вызове триггера (необязательный параметр).
**Возвращаемое значение:** 
Функция, которую можно вызвать с данными (data), чтобы инициировать событие с переданными или скомбинированными данными (контекст и данные).
---
**Типы**
`EventName` - Тип для имени события, который может быть строкой или регулярным выражением.
`Subscriber` - Тип для функции-подписчика.
`EmitterEvent`- Тип для объекта события, который включает имя события (eventName) и данные (data).

```type EventName = string | RegExp;
type Subscriber = Function;
type EmitterEvent = {
 eventName: string;
 data: unknown;
};
```
---
### Описание классов Model
1. ApiModel (наследуется от класса Api) — отвечает за взаимодействие с сервером. Этот класс передает и получает данные, связанные с заказами и товарами.

**Методы:**
`getListProductCard()` - Получает список товаров с сервера (массив объектов карточек).
`postOrderLot()` - Отправляет данные о заказе на сервер и получает ответ о его статусе.

2. BasketModel — управляет данными корзины, которые поступают от пользователя. Хранит информацию о добавленных товарах и их количестве.
```constructor() {
  this.items = []; // Инициализация массива для хранения элементов корзины
  this.totalPrice = 0; // Изначально общая сумма равна 0
}
```
**Методы:**
`getCounter()` - Возвращает количество товаров в корзине.
`getSumAllProducts()` - Рассчитывает и возвращает общую сумму всех товаров в корзине.
`setSelectedCard(product)` - Добавляет товар в корзину.
`deleteCardToBasket(productId)` - Удаляет товар из корзины по идентификатору.
`clearBasketProducts()` - Очищает корзину, удаляя все товары.

3. DataModel — хранит и управляет данными товаров, полученными с сервера.
**Метод:**
`setPreview(product)` - Принимает данные выбранного товара и сохраняет их для отображения подробной информации.

4. FormModel — отвечает за хранение и валидацию данных, полученных от пользователя (например, адрес доставки и контактные данные).
**Методы:**
`setOrderAddress(address)` - Сохраняет адрес пользователя для оформления заказа.
`validateOrder()` - Проверяет валидность введенного адреса и выбранного способа оплаты.
`setOrderData(contactInfo)` - Принимает и сохраняет контактные данные пользователя (номер телефона, почту).
`validateContacts()` - Проверяет корректность контактных данных.
`getOrderLot()` - Возвращает объект, содержащий данные пользователя и выбранные товары для заказа.

### Описание классов View
1. Basket — управляет отображением корзины на веб-странице.
**Методы:**
`renderHeaderBasketCounter()` - Отображает количество товаров в корзине в заголовке.
`renderSumAllProducts()` - Отображает общую сумму всех товаров в корзине.

2. BasketItem — управляет отображением отдельных товаров в корзине.
**Метод:**
`setPrice(price)` - Принимает цену товара в числовом формате и отображает ее как строку.

3. Card — отвечает за отображение карточки товара на странице каталога.
**Методы:**
`setText(element, text)` - Заменяет текстовое содержимое переданного элемента.
`cardCategory(categoryName)` - Устанавливает CSS класс для карточки товара, соответствующий категории.
`setPrice(price)` - Принимает цену товара и возвращает строковое представление этой цены.

4. CardPreview (наследует Card) — отображает подробную информацию о товаре при его выборе, а также управляет кнопкой добавления в корзину.
**Метод:**
`notSale(productData)` - Проверяет наличие цены у товара. Если цена отсутствует, ограничивает возможность покупки.

5. Order — управляет отображением модального окна для оформления заказа. Позволяет пользователю выбрать метод оплаты и ввести адрес доставки.
**Метод:**
`paymentSelection(paymentMethod)` - Отображает обводку вокруг выбранного метода оплаты.

6. Contacts — управляет отображением окна для ввода контактных данных пользователя (телефон и email).

7. Modal — базовый класс для отображения модальных окон.
**Методы:**
`open()` - Открывает модальное окно.
`close()` - Закрывает модальное окно.
`Success` — управляет отображением модального окна с уведомлением об успешном оформлении заказа.

### Пользовательский сценарий:
1. Начинаем с каталога товаров.
2. Кликаем по карточке товара и открывается его подробное описание.
3. Добавляем товар в корзину с помощью кнопки "Купить".
4. Возвращаемся в каталог и можем повторить этот процесс несколько раз, добавляя товары в корзину.
5. Все добавленные товары будут отображаться в корзине.
6. Кликаем на корзину, чтобы перейти к списку добавленных товаров, где можно изменять количество и удалять товары.
7. Нажимаем кнопку "Оформить" и переходим к форме для ввода персональных данных.
8. Заполняем форму с выбором способа оплаты и адресом доставки, а также указываем почту и номер телефона.
9. После нажатия кнопки "Оплатить" происходит процесс оформления заказа.
10. На экране появляется уведомление о том, что заказ оформлен, и сумма списана (при успешной оплате).
11. Нажимаем кнопку "За новыми покупками", чтобы вернуться в каталог товаров.